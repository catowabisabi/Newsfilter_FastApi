version: '3.8'

services:
  newsfilter:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: newsfilter_app
    
    # ğŸ”´ é—œéµè¨­å®š 1: å…±äº«è¨˜æ†¶é«” - è§£æ±º Chrome å¡æ­»å•é¡Œ
    shm_size: '2gb'
    
    # ğŸ”´ é—œéµè¨­å®š 2: è¨˜æ†¶é«”é™åˆ¶ - é˜²æ­¢ Chrome åƒå…‰è¨˜æ†¶é«”
    mem_limit: 4g
    memswap_limit: 4g
    
    ports:
      - "8000:8000"
    
    volumes:
      - .:/app
      - /dev/shm:/dev/shm  # ğŸ”´ é¡å¤–æ›è¼‰å…±äº«è¨˜æ†¶é«”
    
    # ğŸ”´ é—œéµè¨­å®š 3: ç’°å¢ƒè®Šæ•¸
    environment:
      - PYTHONUNBUFFERED=1  # ç«‹å³é¡¯ç¤º print è¼¸å‡º
    env_file:
      - .env  # ğŸ”´ å¾ .env æª”æ¡ˆè®€å– NewsFilter_ID å’Œ NewsFilter_PW
    
    # ğŸ”´ é—œéµè¨­å®š 4: å®‰å…¨è¨­å®š - å…è¨± Chrome åœ¨å®¹å™¨ä¸­é‹è¡Œ
    security_opt:
      - seccomp:unconfined
    
    restart: unless-stopped
    
    # æ—¥èªŒé™åˆ¶ - é˜²æ­¢æ—¥èªŒæª”æ¡ˆéå¤§
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"